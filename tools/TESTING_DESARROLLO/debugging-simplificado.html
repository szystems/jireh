<!DOCTYPE html>
<html>
<head>
    <title>Debugging Simplificado - Formulario Edit Venta</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeeba; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0056b3; }
        .result { margin-top: 10px; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç Debugging Simplificado - Formulario Edit Venta</h1>
    
    <div class="debug-section info">
        <h3>üìã Instrucciones</h3>
        <p><strong>1.</strong> Abre esta p√°gina en una nueva pesta√±a</p>
        <p><strong>2.</strong> En la pesta√±a del formulario de edici√≥n de ventas, abre la consola (F12)</p>
        <p><strong>3.</strong> Si aparece la advertencia de Chrome, escribe: <code>allow pasting</code> y presiona Enter</p>
        <p><strong>4.</strong> Ejecuta los comandos que te proporcione este debugging</p>
    </div>

    <div class="debug-section">
        <h3>üß™ Test 1: Verificaci√≥n B√°sica del Formulario</h3>
        <p>Copia y pega este c√≥digo en la consola del formulario:</p>
        <pre id="test1-code">
// TEST 1: Verificaci√≥n b√°sica
console.log('üîç TEST 1: Verificaci√≥n b√°sica del formulario');
const form = document.querySelector('#forma-editar-venta');
const submitBtn = document.querySelector('#btn-guardar-cambios');
console.log('Formulario encontrado:', !!form);
console.log('Bot√≥n submit encontrado:', !!submitBtn);
if (form) {
    console.log('Action:', form.action);
    console.log('Method:', form.method);
    console.log('Tiene CSRF:', !!form.querySelector('input[name="_token"]'));
    console.log('Tiene METHOD field:', !!form.querySelector('input[name="_method"]'));
}
console.log('‚úÖ Test 1 completado');
        </pre>
        <button onclick="copyToClipboard('test1-code')">üìã Copiar Test 1</button>
        <div id="test1-result" class="result" style="display:none;"></div>
    </div>

    <div class="debug-section">
        <h3>üß™ Test 2: Interceptar Submit Event</h3>
        <p>Copia y pega este c√≥digo para monitorear el evento submit:</p>
        <pre id="test2-code">
// TEST 2: Interceptar submit
console.log('üîç TEST 2: Interceptando evento submit');
const form = document.querySelector('#forma-editar-venta');
if (form) {
    // Remover listeners existentes y agregar uno nuevo
    const newForm = form.cloneNode(true);
    form.parentNode.replaceChild(newForm, form);
    
    newForm.addEventListener('submit', function(e) {
        console.log('üö® SUBMIT INTERCEPTADO!');
        console.log('Event:', e);
        console.log('Target:', e.target);
        console.log('Action:', e.target.action);
        console.log('Method:', e.target.method);
        
        // Verificar datos
        const formData = new FormData(e.target);
        console.log('üìä Datos del formulario:');
        for (let [key, value] of formData.entries()) {
            console.log(`  ${key}: ${value}`);
        }
        
        console.log('‚ö†Ô∏è Previniendo env√≠o para debugging...');
        e.preventDefault();
        return false;
    });
    console.log('‚úÖ Event listener agregado');
} else {
    console.log('‚ùå Formulario no encontrado');
}
console.log('‚úÖ Test 2 completado');
        </pre>
        <button onclick="copyToClipboard('test2-code')">üìã Copiar Test 2</button>
    </div>

    <div class="debug-section">
        <h3>üß™ Test 3: Submit Manual con AJAX</h3>
        <p>Copia y pega este c√≥digo para hacer un submit manual:</p>
        <pre id="test3-code">
// TEST 3: Submit manual con AJAX
console.log('üîç TEST 3: Submit manual con AJAX');
const form = document.querySelector('#forma-editar-venta');
if (form) {
    const formData = new FormData(form);
    
    console.log('üì§ Enviando datos con fetch...');
    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        console.log('üì• Respuesta recibida:');
        console.log('Status:', response.status);
        console.log('Status Text:', response.statusText);
        console.log('URL:', response.url);
        console.log('Headers:', response.headers);
        return response.text();
    })
    .then(data => {
        console.log('üìÑ Contenido de respuesta (primeros 500 chars):');
        console.log(data.substring(0, 500));
        
        if (data.includes('error') || data.includes('Error') || data.includes('exception')) {
            console.log('‚ùå Posible error en respuesta');
        } else if (data.includes('success') || data.includes('redirect')) {
            console.log('‚úÖ Posible √©xito en respuesta');
        }
    })
    .catch(error => {
        console.log('‚ùå Error en fetch:', error);
    });
} else {
    console.log('‚ùå Formulario no encontrado');
}
console.log('‚úÖ Test 3 iniciado - espera la respuesta...');
        </pre>
        <button onclick="copyToClipboard('test3-code')">üìã Copiar Test 3</button>
    </div>

    <div class="debug-section">
        <h3>üß™ Test 4: Verificar Network Tab</h3>
        <p>Este test requiere que observes la pesta√±a Network en DevTools:</p>
        <pre id="test4-code">
// TEST 4: Submit real observando Network
console.log('üîç TEST 4: Submit real - observa la pesta√±a Network');
console.log('üìã INSTRUCCIONES:');
console.log('1. Abre la pesta√±a Network en DevTools');
console.log('2. Ejecuta este c√≥digo');
console.log('3. Observa si aparece una petici√≥n HTTP');

const form = document.querySelector('#forma-editar-venta');
if (form) {
    console.log('‚è≥ Enviando formulario en 3 segundos...');
    console.log('üîç Observa la pesta√±a Network ahora!');
    
    setTimeout(() => {
        console.log('üì§ Enviando formulario ahora...');
        form.submit();
    }, 3000);
} else {
    console.log('‚ùå Formulario no encontrado');
}
        </pre>
        <button onclick="copyToClipboard('test4-code')">üìã Copiar Test 4</button>
        <div class="debug-section warning">
            <strong>‚ö†Ô∏è IMPORTANTE:</strong> El Test 4 realmente enviar√° el formulario. √ösalo solo cuando est√©s listo.
        </div>
    </div>

    <div class="debug-section">
        <h3>üìä Interpretaci√≥n de Resultados</h3>
        <ul>
            <li><strong>Si Test 1 falla:</strong> Problema con la estructura HTML del formulario</li>
            <li><strong>Si Test 2 no muestra el evento:</strong> Otro script est√° interfiriendo con el submit</li>
            <li><strong>Si Test 3 devuelve errores:</strong> Problema en el backend (validaci√≥n, rutas, etc.)</li>
            <li><strong>Si Test 4 no muestra petici√≥n en Network:</strong> El submit est√° siendo bloqueado por JavaScript</li>
        </ul>
    </div>

    <div class="debug-section info">
        <h3>üöÄ Despu√©s de los Tests</h3>
        <p>Comparte los resultados de los tests en el chat para poder identificar exactamente d√≥nde est√° el problema.</p>
    </div>

    <script>
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ C√≥digo copiado al portapapeles');
                }).catch(err => {
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }
        
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('‚úÖ C√≥digo copiado al portapapeles');
                } else {
                    alert('‚ùå No se pudo copiar autom√°ticamente. Por favor copia manualmente.');
                }
            } catch (err) {
                alert('‚ùå No se pudo copiar autom√°ticamente. Por favor copia manualmente.');
            }
            
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
